(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{923:function(e,t,r){"use strict";r.r(t),r.d(t,"Search",(function(){return x})),r.d(t,"SearchResult",(function(){return b}));var n=r(18),i=r(3),o=r(41),a=r(326),s=r(12);function u(e){return g(e)||l(e)||h(e)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}function l(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function g(e){if(Array.isArray(e))return p(e)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var m="search/";function v(e){this.counts=0;for(var t=0;t<e.searchIndex.length;t++)this.counts+=e.searchIndex[t].length;this.progress=null}function b(e){var t=e.pageId,r=e.text,n=e.relevance,i=e.count,o=e.positions,a=e.coincidenceData,s=e.normalizedToVirginMap;this.pageId=t,this.text=r,this.relevance=n,this.count=i,this.positions=o.slice(0),this.normalizedToVirginMap=s,this.coincidenceData=JSON.parse(JSON.stringify(a||{}))}function x(e,t){this.searchState=e,this.store=t,this.status=new v(e)}function S(e,t){for(var r=e.split(" "),n=[],i=0;i<r.length;i++)r[i].length>=t&&n.push(r[i]);return n}function A(e,t){for(var r,n=0;n<e.length&&!(e[n]>t);n++)r=e[n];return r}v.prototype.to=function(){return null===this.progress?null:this.progress===this.counts?"complete":{progress:this.progress,of:this.counts}},v.prototype.from=function(e){Object(i.isString)(e)||(this.progress=null)},b.prototype.addPositions=function(e){this.positions=this.positions.concat(e)},x.prototype.getMinimumQueryLength=function(){return this.searchState.searchCharactersLimit},x.prototype.isQueryValid=function(){var e=this.store.getters["search/trimmedNormalizedQuery"];return!(!this.searchState.query||!e)&&e.length>=this.getMinimumQueryLength()},x.prototype.interrupt=function(){Object(i.isUndefined)(this.searchTimer)||(clearTimeout(this.searchTimer),delete this.searchTimer),this.store.commit(m+n.CLEAR_RESULTS)},x.prototype.search=function(){if(this.interrupt(),!this.isQueryValid())return this.status.progress=null,void this.store.commit(m+n.CHANGE_STATUS,this.status.to());this.status.progress=0,this.store.commit(m+n.CHANGE_STATUS,this.status.to());var e=this,t=0,r=this._buildSearchObject(),i=[];function o(t,n){for(var o=0;o<t.length;o++){if(!e.searchTimer||e.searchTimer!==n)return;var a=e._processPageIndex(r,t[o]);a&&i.push(a)}e.status.progress+=t.length}this.searchTimer=setTimeout((function a(){e.searchState.query===r.noNormalizedQuery&&(e.searchTimer&&t<e.searchState.searchIndex.length?(o(e.searchState.searchIndex[t],e.searchTimer),t++,e.searchTimer=setTimeout(a,e.searchState.searchInterval)):(e.store.state.pager.singleMode?i=e._divideWidePages(i,e.searchState.searchIndex):e.store.state.pager.spreadMode&&(i=e._joinBySpread(i)),0===i.length&&e.store.commit(m+n.SET_ACTIVE_INDEX,{resultIndex:null}),e.store.commit(m+n.ADD_RESULTS,i),e.store.commit(m+n.CHANGE_STATUS,e.status.to())))}),e.searchState.searchInterval)},x.prototype._divideWidePages=function(e,t){for(var r=this,n=[],i=function(i){var o=e[i];if(!r.store.getters["pages/pageProp"](o.pageId.toString(),"wide"))return n.push(o),"continue";o.isWide=!0;var a=[].concat.apply([],t).find((function(e){return e["@ID"]===o.pageId}));if(!a)return n.push(o),"continue";var s=r.store.state.book.rightToLeft,u=a[s?"#half2":"#half1"],c=a[s?"#half1":"#half2"];if(!u||!c)return n.push(o),"continue";var h=[],l=[];o.positions.forEach((function(e){var t=o.normalizedToVirginMap[e.startPos],r=A(u,t),n=A(c,t);(r||0===r)&&(n||0===n)&&n>r||!r&&0!==r?l.push(e):h.push(e)})),h.length&&n.push(r._getHalfItem(o,h,!1)),l.length&&n.push(r._getHalfItem(o,l,!0))},o=0;o<e.length;o++)i(o);return n},x.prototype._joinBySpread=function(e){for(var t=this,r=[],n=function(n){var i=e[n],o=t.store.getters["pages/pageIndexById"](i.pageId.toString()),a=o%2==0?o-1:o+1,s=t.store.getters["pages/pageIdByIndex"](a),u=s&&e.findIndex((function(e){return e.pageId.toString()===s}));if(!s||-1===u)return r.push(i),"continue";var c=e.splice(u,1)[0];r.push(o>a?[c,i]:[i,c])},i=0;i<e.length;i++)n(i);return r},x.prototype._getHalfItem=function(e,t,r){var n=e.coincidenceData,i=e.normalizedToVirginMap;delete e.coincidenceData,delete e.normalizedToVirginMap;var o=JSON.parse(JSON.stringify(e));e.coincidenceData=n,e.normalizedToVirginMap=i,o.positions=t;var a=o.positions.filter((function(e){return e.isFullCoinidence})),s=n.queryArray,u=n.queryArrayLength,c=n.virginContent,h=n.normalizedContent;if(a.length>0)return f(f(f({},o),this._getPreviewTextData(c,h,t[0].startPos,s)),{},{count:t.length===a.length?t.length:t.length-a.length*u,widePageSecondHalf:r,isDivided:!0});var l=this._buildIndexes(s,u,h).map((function(e){return e.filter((function(e){return o.positions.some((function(t){return t.startPos===e}))}))})).filter((function(e){return e.length>0}));return delete(o=f(f(f({},o),this._getRelevanceForParticiallyCoincidence({indexes:l,virginContent:c,normalizedContent:h,queryArray:s,queryArrayLength:u})),{},{widePageSecondHalf:r,isDivided:!0})).coincidenceData,o},x.prototype._buildSearchObject=function(){var e=this.store.getters["search/normalizedQuery"],t=this.store.getters["search/trimmedNormalizedQuery"],r=this.searchState.query,n=e!==t,i=S(e,this.searchState.searchCharactersLimit);return{normalizedQuery:e,trimmedNormalizedQuery:t,noNormalizedQuery:r,trimChangedQuery:n,queryArray:i,queryArrayLength:i.length}},x.prototype._processPageIndex=function(e,t){if(t){var r=t["#text"];if(null!==r){var n=t["@ID"],a=o.default.normalize(r,!0),s=this._searchFullCoincidence({normalizedQuery:e.normalizedQuery,virginContent:r,normalizedContent:a,pageId:n,queryArray:e.queryArray,queryArrayLength:e.queryArray.length});if(!this.searchState.exactMatch&&(e.queryArrayLength>1||e.trimChangedQuery)){var u=this._searchPartiallyCoincidence({virginContent:r,normalizedContent:a,pageId:n,queryArray:e.queryArray,queryArrayLength:e.queryArrayLength});Object(i.isNull)(u)||(s?(s.addPositions(u.positions),s.count+=u.count-s.count*e.queryArrayLength):s=u)}return s&&(s.pageIndex=this.store.getters["pages/pageIndexById"](n)),s}}},x.prototype._getRelevanceForParticiallyCoincidence=function(e){for(var t=e.indexes,r=e.virginContent,n=e.normalizedContent,i=e.queryArray,o=e.queryArrayLength,a=0,s=0,u=new Array(t.length),c=0;c<t.length;c++)u[c]=t[c][0],a+=t[c].length;for(var h=0;h<t.length-1;h++){var l=1e3,g=t[h],p=t[h+1];if(null===g||null===p)break;for(var d=g.length,y=p.length,m=0;m<d;m++)for(var v=0;v<y;v++){var b=g[m],x=p[v],S=x>b?1:2,A=Math.abs(b-x)*S;A<l&&(u[h]=b,u[h+1]=x,l=A)}s+=l}var T=Math.min.apply(Math,[1e4].concat(u));return f({relevance:(s+=1e3*(o-t.length))+4,count:a},this._getPreviewTextData(r,n,T,i))},x.prototype._searchFullCoincidence=function(e){for(var t=e.normalizedQuery,r=e.virginContent,n=e.normalizedContent,o=e.pageId,a=e.queryArray,u=e.queryArrayLength,c=null,h=-1;(h=n.indexOf(t,h+1))>=0;){var l=(0===h||Object(s.isSplitter)(n.charAt(h-1)))&&(h+t.length===n.length||Object(s.isSplitter)(n.charAt(h+t.length)))?0:2;if(Object(i.isNull)(c)||c.relevance>l){var g=Object(i.isNull)(c)?1:c.count+1,p=Object(i.isNull)(c)?[]:c.positions;p.push({startPos:h,stopPos:h+t.length-1,isFullCoinidence:!0}),c=new b(f(f({pageId:o},this._getPreviewTextData(r,n,h,[t])),{},{relevance:l,count:g,positions:p,coincidenceData:{virginContent:r,normalizedContent:n,queryArray:a,queryArrayLength:u}}))}else c&&(c.count++,c.addPositions([{startPos:h,stopPos:h+t.length-1,isFullCoinidence:!0}]))}return c},x.prototype._searchPartiallyCoincidence=function(e){var t=e.virginContent,r=e.normalizedContent,n=e.pageId,i=e.queryArray,o=e.queryArrayLength,a=this._buildIndexes(i,o,r);if(null===a||0===a.length)return null;var s=this._getPositions(i,o,r);return new b(f(f({pageId:n},this._getRelevanceForParticiallyCoincidence({indexes:a,virginContent:t,normalizedContent:r,queryArray:i,queryArrayLength:o})),{},{positions:s,coincidenceData:{virginContent:t,normalizedContent:r,queryArray:i,queryArrayLength:o}}))},x.prototype._getPositions=function(e,t,r){for(var n=[],i=0;i<t;i++)for(var o=e[i],a=0,s=r.indexOf(o,a);s>=0;)n.push({startPos:s,stopPos:s+o.length-1}),a=s+o.length,s=r.indexOf(o,a);return n},x.prototype._buildIndexes=function(e,t,r){for(var n=[],i=0;i<t;i++){var o=[],a=e[i],s=0,u=r.indexOf(a);for(s=u+this.searchState.searchCharactersLimit;u>=0;)o.push(u),s=(u=r.indexOf(a,s))+this.searchState.searchCharactersLimit;o.length>0&&n.push(o)}return n},x.prototype._getPreviewTextData=function(e,t,r,n){n=n||[];var i=parseInt(this.searchState.maxTextResultLength,10),o=Math.max.apply(Math,u(n.map((function(e){return e.length}))))>i/2?Math.floor(i/4):Math.floor(i/2),s=Math.max(0,r-o);n=n.map((function(e){return e.substr(0,s+i-r)}));var c=t.substr(s,i),h=Object(a.getTextMap)(e,t,this.store.state.pager.singleMode?null:s,this.store.state.pager.singleMode?null:i),l=this._getNormalizedTextIndexes(c,s,n);return{text:this._getVirginText({indexes:l,globalBegin:s,globalEnd:s+i,virginText:e,normalizedText:t,normalizedToVirginMap:h}),normalizedToVirginMap:h}},x.prototype._getNormalizedTextIndexes=function(e,t,r){for(var n=[],i=function(i){for(var o=r[i],a=e.indexOf(o);a>=0;)n.some((function(e){return e.begin<=a&&e.end>a}))||n.push({begin:t+a,end:t+a+o.length}),a=e.indexOf(o,a+1)},o=0;o<r.length;o++)i(o);return n.sort((function(e,t){return e.begin-t.begin})),n},x.prototype._getVirginText=function(e){for(var t=e.indexes,r=e.globalBegin,n=e.globalEnd,i=e.virginText,o=e.normalizedText,a=e.normalizedToVirginMap,u=function(e,t,r,n){var u=a?i.substr(a[e],a[t]-a[e]):o.substr(e,t-e);return r?u="..."+u:n&&(u+="..."),Object(s.screening)(u)},c=[],h=0;h<t.length;h++){var l=t[h],g=h>0?t[h-1].end:r;if(c.push({text:u(g,l.begin,0===h),emphasize:!1}),c.push({text:u(l.begin,l.end),emphasize:!0}),h===t.length-1){var p=u(l.end,n,!1,!0);c.push({text:p,emphasize:!1})}}return c}}}]);